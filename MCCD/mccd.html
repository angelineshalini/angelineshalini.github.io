<!DOCTYPE html>
<meta charset="utf-8">

<style>

body {
  font: 14px sans-serif;
  font-weight: bold;
}

.summary {
font-size:120% ;
font-weight: bold;
word-wrap: break-word; }

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}
.bartext{
text-anchor: middle;
	font-family: sans-serif;
	font-size: 120%;
	fill:black;	}
	
.svgtext{

	font-family: sans-serif;
	font-weight: bold;
	font-size: 120%;
	fill:black;	}

.x.axis path {
  display: none;
}

.legend line {
  stroke: #000;
  shape-rendering: crispEdges;
}
.tooltip{
	text-anchor: middle;
	font-family: sans-serif;
	font-size: 120%;
	font-weight: bold;
	fill:black;	
}
optgroup { font-size:120%;font-weight: bold; }
}

#hil-responsive iframe {
  position: absolute;
  top:0;
  left: 0;
  width: 100%;
  height: 100%;
}
#filters{margin-left:35% }
#filters .demo{float:left;
width:20%;height:5%;text-align:center;padding:10px 0;font-size:14px;cursor:pointer;border-top:4px solid #fff;margin-left:1px;}
#filters .demo:hover{background:#f0f0f0;}
#filters .demo.current{border-top:4px solid #000;background:#f0f0f0;}

</style>
<body>
<div>
<h1 >SHARE OF MUSLIMS DECLINES WITH AGE</h1>
</div>
<p style ="font-size:13px" id="menu">                                                       

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select> <optgroup>
<option>INDIA</option>
<option>ANDAMAN & NICOBAR ISLANDS</option>
<option>ANDHRA PRADESH</option>
<option>ARUNACHAL PRADESH</option>
<option>ASSAM</option>
<option>BIHAR</option>
<option>CHANDIGARH</option>
<option>CHHATTISGARH</option>
<option>DADRA & NAGAR HAVELI</option>
<option>DAMAN & DIU</option>
<option>GOA</option>
<option>GUJARAT</option>
<option>HARYANA</option>
<option>HIMACHAL PRADESH</option>
<option>JAMMU & KASHMIR</option>
<option>JHARKHAND</option>
<option>KARNATAKA</option>
<option>KERALA</option>
<option>LAKSHADWEEP</option>
<option>MADHYA PRADESH</option>
<option>MAHARASHTRA</option>
<option>MANIPUR</option>
<option>MEGHALAYA</option>
<option>MIZORAM</option>
<option>NAGALAND</option>
<option>NCT OF DELHI</option>
<option>ODISHA</option>
<option>PUDUCHERRY</option>
<option>PUNJAB</option>
<option>RAJASTHAN</option>
<option>SIKKIM</option>
<option>TAMIL NADU</option>
<option>TRIPURA</option>
<option>UTTAR PRADESH</option>
<option>UTTARAKHAND</option>
<option>WEST BENGAL</option></optgroup>

</select><br><br>
<div id="filters" >

<div class="demo current" data-val="T">Both</div>
<div class="demo" data-val="F">Female</div>
<div class="demo" data-val="M">Male</div>


</div>

<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var legend_width = 100;
var margin = {top: 5, right: 30, bottom: 50, left: 55},
    width =1300-margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
	
	

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .0001);

var y = d3.scale.linear()
    .rangeRound([height, 0]);

var color = d3.scale.category20();

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(d3.format(".0%"));



var svg = d3.select("body").append("svg")
  //  .attr("width", width + margin.left + margin.right+legend_width)
   // .attr("height", height + margin.top + 2*margin.bottom)
	//.attr("class","svgtext")
 // .append("g")
   // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    .attr("viewBox", "0 0 1300 500")
    .attr("preserveAspectRatio", "xMinYMin meet")
	.attr("class","svgtext")
    .append("g")
    .attr("transform", "translate(" + 1.25*margin.left + "," + 2* margin.top +")");

   
	
var svg2 = d3.select("body").append("svg")
   	  .attr("viewBox", "0 0 1300 600")
    .attr("preserveAspectRatio", "xMinYMin meet")
	.attr("class","svgtext")
    .append("g")
    .attr("transform", "translate(" + 1.25*margin.left + "," + margin.top + ")");

	
var menu = d3.select("#menu select").on("change", function() {
UpdatedArea = menu.property("value");
  d3.csv("data-PopbyReligionbyAge.csv", function(error, data) {
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Ages" && key!=="Area"; }));
  data = data.filter(function(d){return d.Area == UpdatedArea});

  redraw (data);
  redraw2(data);
   })});

d3.tsv("data.tsv", function(error, data) {
  if (error) throw error;

  
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Age" && key!=="Sex"; }));
  data = data.filter(function(d){return d.Sex == "T"})
  draw(data)
  
  });
 

function draw(data){
  
  
  data.forEach(function(d) {
    var y0 = 0;
    d.causes = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name],age:d.Age}; });
    d.causes.forEach(function(d) { d.y0 /= y0; d.y1 /= y0; });// d.y0 /=y0 is same as d.y0=d.y0/y0
	  });

  //data.sort(function(a, b) { return b.ages[0].y1 - a.ages[0].y1; });

  x.domain(data.map(function(d) { return d.Age; }));

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
	  .append("text")
      //.attr("transform", "rotate(-90)")
      .attr("x", 800)
	  .attr("y",40)
      .attr("dx", ".35em")
      .style("text-anchor", "end")
      .text("Age (years)");

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
	  .append("text")
      .attr("transform", "rotate(-90)")
	  .attr("x",-20)
      .attr("y", -55)
	  .attr("dy", ".35em")
      .style("text-anchor", "end");

var state = svg.selectAll(".state")
      .data(data)
	  .enter().append("g")
      .attr("class", "state")
      .attr("transform", function(d) { return "translate(" + x(d.Age) + ",0)"; });


 state.selectAll("rect")
      .data(function(d) { return d.causes; })  
       .enter().append("rect")
      .attr("width", x.rangeBand())
	  .attr("y", function(d) { return y(d.y1); })
      .attr("height", function(d) { return y(d.y0) - y(d.y1); })
      .style("fill", function(d) { return color(d.name); })
	  ;
	
	state.selectAll("rect")
      .data(function(d) { return d.causes; })  
	  .on("mouseover",function(d,i){
	     if (d.name != "MUSLIMS")
	        {var xPos = x(d3.select(this.parentNode).datum( ).Age);
				var yPos = parseFloat(d3.select(this).attr("y"));
				var barheight = parseFloat(d3.select(this).attr("height"))
				if (barheight < 10){yPos =0}				
				d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
				
			var t =	svg.append("text")
					.attr("x",xPos+20)
					.attr("y",yPos+barheight/2)
					.attr("class","tooltip")
					.text(((d.y1-d.y0)*100).toFixed(2)); 
					console.log(t)
            }})
		.on("mouseout",function(){
			svg.select(".tooltip").remove();
			d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
														
		});
	  


  

 state.selectAll(".bartext")
      .data(function(d){return d.causes;})
	  .enter()
	  .append("text")
	  .attr("class", "bartext")
.attr("text-anchor", "middle")
.attr("fill", "black")
//.attr("x", function(d) { return x(d.Age)
.attr("dx","3em")
.attr("y", function(d,i) {
    return y(d.y1)+ 25;
})
.text(function(d){
     if ((d.name == "Infection" && d.age =="15-24")||(d.name == "Circulatory" && d.age =="70+") 
	    || (d.name == "External causes" && d.age =="25-34")||(d.name == "ssa" && d.age =="70+") 
	    || (d.name == "Respiratory" && d.age =="1-4")||(d.name == "Neoplasm" && d.age =="55-64") 
	    || (d.name == "Nervous" && d.age =="1-4")||(d.name == "Digestive" && d.age =="45-54") 
	    || (d.name == "Blood" && d.age =="1-4")||(d.name == "Endocrine" && d.age =="65-69") 
	    || (d.name == "Others" && d.age =="25-34")		)
	 
	 { return d.name;}}
);
	  
//adding labels for data = MUSLIMS only


 


};
function redraw(data){
  data.forEach(function(d) {
    var y0 = 0;
    d.religions = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
    d.religions.forEach(function(d) { d.y0 /= y0; d.y1 /= y0; });
  });

  //data.sort(function(a, b) { return b.ages[0].y1 - a.ages[0].y1; });

  x.domain(data.map(function(d) { return d.Ages; }));

  

  var state = svg.selectAll(".state")
      .data(data)
      .attr("class", "state")
      .attr("transform", function(d
	  ) { return "translate(" + x(d.Ages) + ",0)"; });

 state.selectAll("rect")
      .data(function(d) { return d.religions; })  
      .attr("y", function(d) { return y(d.y1); })
      .attr("height", function(d) { return y(d.y0) - y(d.y1); })
      .style("fill", function(d) { return color(d.name); });
	  
state.selectAll("rect")
      .data(function(d) { return d.religions; })  
	  .on("mouseover",function(d,i){
	     if (d.name != "MUSLIMS")
	        {var xPos = x(d3.select(this.parentNode).datum( ).Ages);
				var yPos = parseFloat(d3.select(this).attr("y"));
				var barheight = parseFloat(d3.select(this).attr("height"));
				if (barheight < 10){yPos =0}
								
				d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
				
			var t =	svg.append("text")
					.attr("x",xPos+20)
					.attr("y",yPos+barheight/2)
					.attr("class","tooltip")
					.text(((d.y1-d.y0)*100).toFixed(2)); 
					console.log(t)
            }})
		.on("mouseout",function(){
			svg.select(".tooltip").remove();
			d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
														
		});
 
 
 state.selectAll(".bartext")
      .data(function(d){return d.religions;})
	  .attr("class", "bartext")
.attr("text-anchor", "middle")
.attr("fill", "black")
.attr("x", function(d,i) { return i*(width/data.length) -40})
.attr("y", function(d,i) {
    return y(d.y1)+10;
})
.text(function(d){
     if (d.name == "MUSLIMS"){ a= (d.y1-d.y0)*100 ; return a.toFixed(2);}}
);
 
};

</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49609780-1', 'auto');
  ga('send', 'pageview');

</script>
