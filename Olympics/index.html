<!DOCTYPE html>
<meta charset='UTF-8'>

<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>

</head>
<style>

div.tooltip {   
  position: fixed;           
  text-align: center;           
  width: 100px;                  
  height: 55px;                 
  padding: 2px;             
  font: 12px sans-serif;        
  background: lightsteelblue;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;         
}

div.tooltip2 {   
  position: absolute;           
  text-align: center;           
  width: 100px;                  
  height: 55px;                 
  padding: 2px;             
  font: 12px sans-serif;        
  background: #ffcccc;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;         
}
.ui-dialog {
    position: relative; 
    padding: .2em; 
    background :lavender;
    border: 2px solid white;
}
.ui-dialog .ui-dialog-content {
    border: 0
    padding: .5em 1em;
    background: lavender;
    overflow: auto;
    zoom: 1;
}
#resizable { width: 900px; height: 700px; padding: 0.5em; }
  #resizable h3 { text-align: center; margin: 0; }
table {
    border-collapse: collapse;
    width: 100%;
}

th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}
th{
    background-color:#f5f5f5;
}
body {
  font: sans-serif;
  font-size: 120%
  <!-- background-color : lavender -->
}
.brush .extent {
  stroke: #fff;
  fill-opacity: .500;
  shape-rendering: crispEdges;
}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
svg {
  font: sans-serif;
  font-size :120%;
  
}  
statictxt{font-size:80%}
.svgtext{

	font-family: sans-serif;
	font-weight: normal;
	font-size: 120%;
	fill:black;	}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis2 {font-size :75%}

.axis2 path, .axis2 line{fill :none;}


.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}
.line2 {
  fill: none;
  stroke: red;
  stroke-width: 1.5px;
}
.line3 {
  fill: none;
  stroke: green;
  stroke-width: 1.5px;
}
.overlay {
  fill: none;
  pointer-events: all;
}



.points circle {
  stroke: #fff;
  stroke-width: 1.5px;
  
}

.brush .extent {
  stroke: #fff;
  fill-opacity: .125;
  shape-rendering: crispEdges;
}
</style>
<body>

<div id="container">
      <h1 id="headline" class="viz-head">Tracing world records in athletics and swimming since 1970</h1>
         </div>  
    


<form name="info">
<tr>

<td><FONT COLOR="#4682B4">Gender:</td><td><select name ="gender" id ="gender" onchange ="configureDropDownLists(this,'evento');">
<option value="Men"selected >Men</option>
<option value="Women"  >Women</option></select>

<td>Sport: </td>
<td><select name="sport
" id="sport" onchange="configureDropDownLists(this,'evento');">
<option value="Athletics" >Athletics</option>
<option value="Swimming">Swimming</option>
</select></td>
<td>Event: </FONT></td>
<td><select name="event" id="evento" onchange = "updategraph();">
<option value = "100 metres" selected>100 metres</option>
<option value ="200 metres">200 metres</option>
<option value ="400 metres">400 metres</option>
<option value ="800 metres">800 metres</option>
<option value ="1500 metres">1500 metres</option>
<option value ="5,000 metres">5,000 metres</option>
<option value ="10,000 metres">10,000 metres</option>
<option value ="110 metre hurdles">110 metre hurdles</option>
<option value ="400 metre hurdles">400 metre hurdles</option>
<option value ="3,000 metres steeplechase">3,000 metres steeplechase</option>
<option value ="4x100 metres relay">4x100 metres relay</option>
<option value ="4x400 metres relay">4x400 metres relay</option>
<option value ="Marathon">Marathon</option>
<option value ="20 km walk">20 km walk</option>
<option value ="50 km walk">50 km walk</option>
</select></td>

<tr><br><br>
<td><FONT COLOR="#ff0000">Gender:</td><td><select name ="gender" id ="gender1" onchange = "configureDropDownLists1(this,'event1');">
<option value="Men">Men</option>
<option value="Women"  selected >Women</option></select>


<td>Sport: </td>
<td><select name="sport
" id="sport1" onchange="configureDropDownLists1(this,'event1');">
<option value="Athletics" >Athletics</option>
<option value="Swimming">Swimming</option>
</select></td>
<td>Event: </FONT></td>
<td><select name="event" id="event1" onchange = "updategraph();">
<option value = "100 metres" selected>100 metres</option>
<option value ="200 metres">200 metres</option>
<option value ="400 metres">400 metres</option>
<option value ="800 metres">800 metres</option>
<option value ="1500 metres">1500 metres</option>
<option value ="5,000 metres">5,000 metres</option>
<option value ="10,000 metres">10,000 metres</option>
<option value ="400 metre hurdles">400 metre hurdles</option>
<option value ="3,000 metres steeplechase">3,000 metres steeplechase</option>
<option value ="4x100 metres relay">4x100 metres relay</option>
<option value ="4x400 metres relay">4x400 metres relay</option>
<option value ="Marathon">Marathon</option>
<option value ="20 km walk">20 km walk</option>
</select></td>
</tr><br><br><br><br>


<script>
//Populating the select options for event drop down

place = {
	Athletics:['100 metres','200 metres','400 metres','800 metres','1500 metres','5,000 metres',
'10,000 metres','110 metre hurdles','400 metre hurdles','3,000 metres steeplechase',
'4x100 metres relay','4x400 metres relay','Marathon',
'20 km walk','50 km walk'],
	Swimming:['Freestyle 50 metres','Freestyle 100 metres','Freestyle 200 metres','Freestyle 400 metres','Freestyle 800 metres',
'Freestyle 1500 metres','Butterfly 100 metres','Butterfly 200 metres','Breaststroke 100 metres','Breaststroke 200 metres',
'Backstroke 100 metres','Backstroke 200 metres','200 metres individual medley','400 metres individual medley',
'4x100 metres freestyle relay','4x200 metres freestyle relay','4x100 medley relay']
	};
place2 = {
	Athletics:['100 metres','200 metres','400 metres','800 metres','1500 metres','5,000 metres',
'10,000 metres','400 metre hurdles','3,000 metres steeplechase',
'4x100 metres relay','4x400 metres relay','Marathon','20 km walk'],
	Swimming:['Freestyle 50 metres','Freestyle 100 metres','Freestyle 200 metres','Freestyle 400 metres','Freestyle 800 metres',
'Freestyle 1500 metres','Butterfly 100 metres','Butterfly 200 metres','Breaststroke 100 metres','Breaststroke 200 metres',
'Backstroke 100 metres','Backstroke 200 metres','200 metres individual medley','400 metres individual medley',
'4x100 metres freestyle relay','4x200 metres freestyle relay','4x100 medley relay']
	};

function clearOpts(target){
	sel = document.info[target].options;
	for (i = sel.length - 1; i >= 0; i--)
		sel.remove(i);
}

function configureDropDownLists(o,event) {
	if(document.info[event].options.length!=0) clearOpts(event);
	selected = o.selectedIndex;
	if(selected== -1) return;
	event = o.options[selected].value;
	var gc =  document.getElementById("gender");
	var genderchoice= gc.options[gc.selectedIndex].value;
	var sc = document.getElementById("sport");
	var sportchoice= sc.options[sc.selectedIndex].value;
   if (genderchoice == 'Men') 
	{for (i = 0; i < place[sportchoice].length; i++) {
				createOption('evento', place[sportchoice][i], place[sportchoice][i]) }}
	else 
	{for (i = 0; i < place2[sportchoice].length; i++) {
				createOption('evento', place2[sportchoice][i], place2[sportchoice][i]) }}
			
	updategraph();		
}

function configureDropDownLists1(o,event) {
		if(document.info[event].options.length!=0) clearOpts(event);
	selected = o.selectedIndex;
	if(selected== -1) return;
	event = o.options[selected].value;
	var gc =  document.getElementById("gender1");
	var genderchoice= gc.options[gc.selectedIndex].value;
	var sc = document.getElementById("sport1");
	var sportchoice= sc.options[sc.selectedIndex].value;
   if (genderchoice == 'Men') 
	{for (i = 0; i < place[sportchoice].length; i++) {
				createOption('event1', place[sportchoice][i], place[sportchoice][i]) }}
	else 
	{for (i = 0; i < place2[sportchoice].length; i++) {
				createOption('event1', place2[sportchoice][i], place2[sportchoice][i]) }}
			
	updategraph();			
}

function configureDropDownLists2(o,event) {
	if(document.info[event].options.length!=0) clearOpts(event);
	selected = o.selectedIndex;
	if(selected== -1) return;
	event = o.options[selected].value;
	for (i = 0; i < place[event].length; i++) {
				createOption('event2', place[event][i], place[event][i]) 
			}
	updategraph();		
}

function createOption(target, label, value) {
	opts = document.info[target];
	opts.options.add(new Option(label,value) );
}
			

var margin = {top: 170, right: 200, bottom: 30, left: 80},
   // margin2 = {top: 330, right: 10, bottom: 20, left: 60},
    width = 1200 - margin.left - margin.right,
    height =0.4*width;
   // height2 = 400 - margin2.top - margin2.bottom;

	
var parseDate = d3.time.format("%Y").parse,
    bisectDate = d3.bisector(function(d) { return d.Year; }).left,
    formatValue = d3.format(",.2f" ),
    formatCurrency = function(d) { return "$" + formatValue(d); };
	
var formatTime = d3.time.format("%Y");

var x = d3.time.scale()
    .range([0, width]);
var x2 = d3.time.scale().range([0,width]);
     

var y = d3.scale.linear()
    .range([height, 0]);
//var y2 = d3.scale.linear().range([height2,0]);
var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

 var yAxis = d3.svg.axis()
    .scale(y)
   .orient("left");
	
//var xAxis2 = d3.svg.axis().scale(x2).orient("bottom");

//var brush = d3.svg.brush().x(x2).on("brush", brushed);

//var data, data1,data2;
var line = d3.svg.line()
    .x(function(d) { return x(d.Year); })
    .y(function(d) { return y(d.Time); });
	
var line2 = d3.svg.line()
    .x(function(d) { return x(d.Year); })
    .y(function(d) { return y(d.Time); });

var line3 = d3.svg.line()
    .x(function(d) { return x(d.Year); })
    .y(function(d) { return y(d.Time); });



var svg = d3.select("body").append("svg")
    
	.attr("viewBox", "0 0 1300 840")
    .attr("preserveAspectRatio", "xMinYMin meet")
	.attr("class","svgtext")
	.style("background-color", "lavender")
    .append("g")
    .attr("transform", "translate(" + margin.left + "," +0.5* margin.top +")");

var clipPath = svg.append("defs").append("svg:clipPath")
    .attr("id", "clip")
  .append("rect")
    .attr("width", width)
    .attr("height", height+30)
	.attr("x",-10)
	.attr("y",-10);
	
//var context = svg.append("g")
   // .attr("class", "context")
    //.attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

d3.select("body").append("br");
//For table
var Sumtable =d3.select("body").append("table").attr("id","table1");
var thead = Sumtable.append("thead").append("tr");
var tbody = Sumtable.append("tbody");
d3.select("body").append("br");
//Notes
var note = 	d3.select("body").append("text")
         .style("font-weight","bold")
       // .style("text-decoration", "underline")  
        .style("font-size", "90%") 		
	    .text("Notes: ")
note.append("br");
note.append("text")
.style("font-weight","normal")
        .style("text-decoration", "none") 
           .text("1. Timings/Distance have been rebased to 100 to enable comparison. So, the world record time/distance in a discipline on the starting date of the visualisation (January 1, 1976) was taken as 100. And then, the progressive drop in time/distance was calculated relative to 100.")

note.append("br");

note.append("text")
.style("font-weight","normal")
        .style("text-decoration", "none") 
           .text("2. In events that were introduced after January 1, 1976 (women’s 10,000 metres and 3,000 metres steeplechase in athletics, and the 4 x 200 metres freestyle relay for both men and women in swimming), the starting point is the first world record.")

		   note.append("br");

		   note.append("text")
.style("font-weight","normal")
        .style("text-decoration", "none") 
           .text("3. Data as of August 8, 2016")

		   note.append("br");
		   note.append("br");
		   
note.append("text")
        .style("font-weight","normal")
        .attr("text-anchor", "left")  
        .text("Data Source: Wikipedia")
	
// For Tooltip
var div = d3.select("body").append("div")   
    .attr("class", "tooltip")               
    .style("opacity", 0);
var div1 = d3.select("body").append("div")   
    .attr("class", "tooltip2")               
    .style("opacity", 0);

var div2 = d3.select("body").append("div")   
    .attr("class", "tooltip")
     .style("opacity", 0);	

	var div3 = d3.select("body").append("div")   
    .attr("class", "tooltip")
     .style("opacity", 0);	
	 
	 var div4 = d3.select("body").append("div")   
    .attr("class", "tooltip2")
     .style("opacity", 0);	

	var div5 = d3.select("body").append("div")   
    .attr("class", "tooltip2")
     .style("opacity", 0);	
	    
		var div6 = d3.select("body").append("div")   
    .attr("class", "tooltip2")
     .style("opacity", 0);	
	    var div7 = d3.select("body").append("div")   
    .attr("class", "tooltip2")
     .style("opacity", 0);	
	 
	    


   
   
d3.tsv("data2.tsv", function(error, data) {
  if (error) throw error;

  data.forEach(function(d) {
    d.Year = parseDate(d.Year);
    d.Time= +d.Time;
  }); 
  var start  = parseDate('1975');
  var end = parseDate('2016');
  
  x.domain([start, end]);
 
 
  
  data1 = data.filter(function(d){return d.Sport == "Athletics" && d.Gender =="Men" && d.Event == "100 metres"});

  var d1array =[];
  d1array[0] =[];
 
  for (i=0;i<data1.length;i++)
   { d1array[i] = []; 
   d1array[i][0] = data1[i].Sport;
      d1array[i][1] = data1[i].Gender;
      d1array[i][2] = data1[i].Event;
      d1array[i][3] = data1[i].Timetxt.concat(data1[i].Unit);
      d1array[i][4] = data1[i].Athlete;
      d1array[i][5] = data1[i].Nationality;
   //   d1array[i][6] = data1[i].Location;
      d1array[i][6] = formatTime(data1[i].Year);}
  
  
  data2 = data.filter(function(d){return d.Sport == "Athletics" && d.Gender =="Women" && d.Event == "100 metres"});
   
   var d2array =[];
  d2array[0] =[];
	  
  for (i=0;i<data2.length;i++)
   { d2array[i] = []; 
   d2array[i][0] = data2[i].Sport;
      d2array[i][1] = data2[i].Gender;
      d2array[i][2] = data2[i].Event;
      d2array[i][3] = data2[i].Timetxt.concat(data2[i].Unit);
      d2array[i][4] = data2[i].Athlete;
      d2array[i][5] = data2[i].Nationality;
      d2array[i][6] = formatTime(data2[i].Year);}
 
 
  // Making y domain a function of current selection of data
  superdata = data1.concat(data2);
    superdata.sort(function(a, b) {
    return a.Time- b.Time;
  });
   y.domain([superdata[0].Time-1,superdata[superdata.length -1].Time]);
   
 
// Drawing the lines 
   drawline1(data1);
   drawline2(data2);
 
  
   
  //Populating the Sumtable
   rowa1data = (data1[0].Gender).concat("'s ",data1[0].Sport," ",data1[0].Event);
  rowa2data = data1.length-1;
  rowa3data = data1[data1.length-1].Timeinseconds - data1[0].Timeinseconds;
  
  rowa3data = rowa3data.toFixed(2);
  rowa3data = rowa3data.concat(' sec');
  
  
  
     rowb1data = (data2[0].Gender).concat("'s ",data2[0].Sport," ",data2[0].Event);
  rowb2data = data2.length-1;
  rowb3data = data2[data2.length-1].Timeinseconds - data2[0].Timeinseconds;
  
  rowb3data = rowb3data.toFixed(2);
  rowb3data = rowb3data.concat(' sec')
   

  alldata = [[rowa1data,rowa2data,rowa3data],[rowb1data,rowb2data,rowb3data]];//,[rowc1data,rowc2data,rowc3data]];
  
 //add Sum table
 
	
var columns = ['Event','No. of Records Set', 'Decline in Time'];


thead.selectAll("th")
    .data(columns)
    .enter()
    .append("th")
    .text(function(d) {
        return d;
    });
	
var trows = tbody
    .selectAll("tr")
    .data(alldata)
    .enter()
    .append("tr");

var tcells = trows
    .selectAll("td")
    .data(function(d, i) { return d; })
    .enter()
    .append("td")
    .text(function(d, i) { return d; });

thead.append("th").text('Records');
trows.selectAll("td.button")
//use a class so you don't re-select the existing <td> elements
          .data(function(d) {return [d];})
          .enter()
            .append("td")
            .attr("class", "button")
            .append("button")			
	        .attr("id",function(d,i,j) {return "button"+j;})
            .text(function(d){return "Details"});

//# creating table -on click button display

//PopTable1
var columns2 = ['Sport','Gender','Event','Time','Athlete','Nationality','Year'];

var thead2 = d3.select("#test1").selectAll("th")
    .data(columns2)
    .enter()
    .append("th")
    .text(function(d) {
        return d;
    });
	
var rows2 =d3.select("#test1").append('tbody').selectAll("tr").data(d1array).enter() .append("tr");
var cells2 = rows2.selectAll("td").data(function(d, i) { return d; })
             .enter()
             .append("td")
              .text(function(d, i) { return d; });
 
//PopTable2
var thead3 = d3.select("#test2").selectAll("th")
    .data(columns2)
    .enter()
    .append("th")
    .text(function(d) {
        return d;
    });
	
var rows3 =d3.select("#test2").append('tbody').selectAll("tr").data(d2array).enter() .append("tr");
var cells2 = rows3.selectAll("td").data(function(d, i) { return d; })
             .enter()
             .append("td")
              .text(function(d, i) { return d; });
	
////////////////////////////////
$(document).ready(function() {			
$("#button0").click(function (){
   
   $( "#dialog-modal" ).dialog({
          open : function (event, ui){$("#test1").appendTo("#dialog-modal");       
	                                   $( "#dialog-modal" ).show();
	                                   $("#test1").show();
									   },
		  //close : function (event, ui){$( "#dialog-modal" ).html(" " );},
		  height: 500,
		  width: 900,
		   modal: true
        });
$( "#resizable" ).resizable();
   
    });
	
	});
 

  /// for button1
  
  $(document).ready(function() {			
$("#button1").click(function (){

   $( "#dialog-modal1" ).dialog({
          open : function (event, ui){$("#test2").appendTo("#dialog-modal1");       
	                                  $( "#dialog-modal1" ).show();
	                                  $("#test2").show();
									 },
		 // close : function (event, ui){$( "#dialog-modal" ).html(" " );},
          height: 500,
		  width: 900,
		   modal: true
        });
$( "#resizable" ).resizable();
   //.delay(1000).fadeOut();
    });
	
	});
 
			
   ///////////////////WINDOW RESIZE///////////////////////////////////
   
   $(window).resize(function () {
   $('.ui-dialog').css({
        'width': $(window).width(),
        'height': $(window).height(),
        'left': '0px',
        'top':'0px'
   });
}).resize(); 
   })


  function  drawline1(data1){
  
  svg.append("g")
      .attr("class", "x axis")
	  .attr("id","xaxis")
      .attr("transform", "translate(0," + (height-10) + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
     .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
     .attr("y", -65)
     .attr("x", -20)
     .attr("dy", ".71em")
      .style("text-anchor", "end")
	  .style("font-size", "100%")
     .text("TIME (normalized)");


data1.push({
Sport:"Dummy",	
Gender:"Dummy",
Event:"Dummy",
Time:data1[data1.length -1].Time,
Timetxt: 'Dummy',
Athlete:'Dummy',
Nationality:'Dummy',
Year: parseDate('2017'),
Timeinseconds:data1[data1.length -1].Timeinseconds,});
  
  svg.append("path")
      .datum(data1)
      .attr("class", "line")
      .attr("d", line);
	  
 
	  


data1 = data1.filter(function(d){return formatTime(d.Year) != "2017"});
// Add the scatterplot
    svg.append("g").selectAll("circle")
        .data(data1)
      .enter().append("circle")
        .attr("r", 3 )
  .attr("fill","steelblue")
        .attr("cx", function(d) {return x(d.Year); })
        .attr("cy", function(d) { return y(d.Time); })
		 .on("mouseover",  function (d,i) {if ( i > 0 && i < (data1.length-1)){div.transition()        
                .duration(50)      
                .style("opacity", .9);
             div.html(d.Athlete+"<br/>"+"Time:" +d.Timetxt+ "("+d.Unit+ ")"+"<br/>" +"Year:"+d.Yeartxt )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY - 28) + "px");    
            }})                  
        .on("mouseout", function(d) {       
            div.transition()        
                .duration(100)      
                .style("opacity", 0);
	   
	   
        });
  
  svg.append('rect')
	      .attr("y",y(data1[data1.length -1].Time)-10)
		  .attr("x", width+25)
	   .attr("width",65)
	   .attr("height",30)
	   .attr("class","bar")
	  .style("fill"," lightsteelblue")
	  //.style("border", 1)
	 // .style("stroke", "black");
	  
svg.append('text')
      .attr("class","perftxt")
	  .attr("y",y(data1[data1.length -1].Time)+10)
		  .attr("x", width+27.5)
	  .text(((data1[0].Timeinseconds - data1[data1.length -1].Timeinseconds)/data1[0].Timeinseconds*100 ).toFixed(2)+"%")
	  

svg.append('rect')
	      .attr("y",y(data1[0].Time)-75)
		  .attr("x", x(data1[0].Year)+10)
	   .attr("width","14%")
	   .attr("height","13%")
	   .attr("class","startbar")
	   .attr("rx",10).attr("ry",10)
	  .style("fill","  lightsteelblue")
	  .style("opacity", .9);
	  
svg.append('text')
      .attr("font-size","90%")
	  .attr("class","starttxt")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
	  .attr("y",y(data1[0].Time)-75)
		  .attr("x", x(data1[0].Year)+80)
	.append('tspan')
	.attr('x',x(data1[0].Year)+90)
  .attr('dy', 20)
	  .text(data1[0].Athlete)
	  .append('svg:tspan')
	    .attr('x',x(data1[0].Year)+90)
  .attr('dy', 20)
  .text("Time:" +data1[0].Timetxt +"("+data1[0].Unit+ ")")
  .append('svg:tspan')
  .attr('x',x(data1[0].Year)+90)
  .attr('dy', 20)
  .text("Year:"+data1[0].Yeartxt );

	  	


	//div2.transition()        
      //          .duration(50)      
        //        .style("opacity", .9);
          //   div2.html(data1[0].Athlete+"<br/>"+"Time:" +data1[0].Timetxt+ "("+data1[0].Unit+ ")"+"<br/>" +"Year:"+data1[0].Yeartxt )  
            //    .style("left", x(data1[0].Year)+100+"px")     
              //  .style("top",  y(data1[0].Time)+170+"px");        
//div3.transition()        
  //              .duration(50)      
    //            .style("opacity", .9);
      //       div3.html(data1[14].Athlete+"<br/>"+"Time:" +data1[14].Timetxt+ "("+data1[14].Unit+ ")"+"<br/>" +"Year:"+data1[14].Yeartxt )  
        //        .style("left", width+"px")     
          //      .style("top",  400+"px"); 
 
 svg.append('rect')
	      .attr("y",y(data1[data1.length-1].Time)-70)
		  .attr("x", width+100)
	   .attr("width","14%")
	   .attr("height","14%")
	   .attr("class","endbar")
	   .attr("rx",10).attr("ry",10)
	  .style("fill","lightsteelblue")
	  .style("opacity", .9);
	  
svg.append('text')
      .attr("font-size","90%")
	  .attr("class","endtxt")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
	  .attr("y",y(data1[data1.length-1].Time)-70)
		  .attr("x", width+200)
	.append('tspan')
	.attr("x", width+200)
  .attr('dy', 20)
	  .text(data1[data1.length-1].Athlete)
	  .append('svg:tspan')
	   .attr("x", width+200)
  .attr('dy', 20)
  .text("Time:" +data1[data1.length-1].Timetxt +"("+data1[data1.length-1].Unit+ ")")
  .append('svg:tspan')
 .attr("x", width+200)
  .attr('dy', 20)
  .text("Year:"+data1[data1.length-1].Yeartxt );
 
 
  };
 
 
function  drawline2(data){
  
data.push({
Sport:"Dummy",	
Gender:"Dummy",
Event:"Dummy",
Time:data[data.length -1].Time,
Timetxt: 'Dummy',
Athlete:'Dummy',
Nationality:'Dummy',
Year: parseDate('2017'),
Timeinseconds:data[data.length-1].Timeinseconds});

  svg.append("path")
      .datum(data)
      .attr("class", "line2")
      .attr("d", line2);
	  
	  
 
 data = data.filter(function(d){return formatTime(d.Year) != "2017"});	  
  
 svg.append('rect')
	      .attr("y",y(data[data.length -1].Time)-10)
		  .attr("x", width+25)
	   .attr("width",65)
	   .attr("height",30)
	   .attr("class","bar2")
	  .style("fill","#ffcccc");
	  //.style("border", 1)
	 // .style("stroke", "black");
	  
svg.append('text')
	  .attr("class","perftxt")
	  .attr("y",y(data[data.length -1].Time)+10)
		  .attr("x", width+27.5)
	  .text(((data[0].Timeinseconds - data[data.length -1].Timeinseconds)/data[0].Timeinseconds*100 ).toFixed(2)+"%");
  	 
 
 

   
// Add the scatterplot
    svg.append("g").selectAll("circle")
        .data(data)
      .enter().append("circle")
        .attr("r", 3)
  .attr("fill","red")
        .attr("cx", function(d) { return x(d.Year); })
        .attr("cy", function(d) { return y(d.Time); })
		 .on("mouseover", function(d,i) { if ( i > 0 && i < (data.length-1))      
           { div1.transition()        
                .duration(50)      
                .style("opacity", .9);      
                div1.html(d.Athlete+"<br/>"+"Time:" +d.Timetxt+ "("+d.Unit+ ")"+"<br/>" +"Year:"+d.Yeartxt )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY - 28) + "px");    
            }})                  
        .on("mouseout", function(d) {       
            div1.transition()        
                .duration(100)      
                .style("opacity", 0);   
        });
svg.append('rect')
	      .attr("y",height/2)
		  .attr("x", x(data[0].Year)+20)
	   .attr("width","14%")
	   .attr("height","14%")
	   .attr("class","startbar1")
	   .attr("rx",10).attr("ry",10)
	  .style("fill","  #ffcccc")
	  .style("opacity", .9);
	  
svg.append('text')
      .attr("font-size","90%")
	  .attr("class","starttxt")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
	  .attr("y",height/2)
      .attr("x", x(data[0].Year)+80)
	.append('tspan')
	.attr('x',x(data[0].Year)+105)
  .attr('dy', 20)
	  .text(data[0].Athlete)
	  .append('svg:tspan')
	    .attr('x',x(data[0].Year)+90)
  .attr('dy', 20)
  .text("Time:" +data[0].Timetxt +"("+data[0].Unit+ ")")
  .append('svg:tspan')
  .attr('x',x(data[0].Year)+105)
  .attr('dy', 20)
  .text("Year:"+data[0].Yeartxt );

 
 svg.append('rect')
	      .attr("y",y(data[data.length-1].Time)-70)
		  .attr("x", width+100)
	   .attr("width","14%")
	   .attr("height","14%")
	   .attr("class","endbar1")
	   .attr("rx",10).attr("ry",10)
	  .style("fill","#ffcccc")
	  .style("opacity", .9);
	  
svg.append('text')
      
	  .attr("font-size","90%")
      .attr("font","sans-serif")
	  .attr("class","endtxt")
	  .attr("text-anchor","middle")
	  .attr("y",y(data[data.length-1].Time)-70)
		  .attr("x", width+200)
	.append('tspan')
	.attr("x", width+200)
  .attr('dy', 20)
	  .text(data[data.length-1].Athlete)
	  .append('svg:tspan')
	   .attr("x", width+200)
  .attr('dy', 20)
  .text("Time:" +data[data.length-1].Timetxt +"("+data[data.length-1].Unit+ ")")
  .append('svg:tspan')
.attr("x", width+200)
  .attr('dy', 20)
  .text("Year:"+data[data.length-1].Yeartxt );
  
   
  };

  
  
  function updategraph() {
  
  
   //Getting updated values
   var  e = document.getElementById("gender");
  var genderselected = e.options[e.selectedIndex].value;
  var  e1 = document.getElementById("gender1");
  var genderselected1 = e1.options[e1.selectedIndex].value;
  
  var f = document.getElementById("sport");
  sportselected = f.options[f.selectedIndex].value;
  var f1 = document.getElementById("sport1");
  sportselected1 = f1.options[f1.selectedIndex].value;

  
  var g = document.getElementById("evento");
  eventselected = g.options[g.selectedIndex].value;
  var g1 = document.getElementById("event1");
  eventselected1 = g1.options[g1.selectedIndex].value;
 
  
  d3.tsv("data2.tsv", function(error, data) {
  if (error) throw error;
  
  data.forEach(function(d) {
    d.Year = parseDate(d.Year);
    d.Time= +d.Time;
  });
  
 var start  = parseDate('1975');
  var end = parseDate('2016');
  x.domain([start, end]);
 
  

    
  data1 = data.filter(function(d){return d.Sport == sportselected && d.Gender == genderselected&& d.Event == eventselected});
 
//Tranforming data, from an array of objects to 2 D array of   data , for dynamic table creation
  var d1array =[];
  d1array[0] =[];
  	  
  for (i=0;i<data1.length;i++)
   { d1array[i] = []; 
   d1array[i][0] = data1[i].Sport;
      d1array[i][1] = data1[i].Gender;
      d1array[i][2] = data1[i].Event;
      d1array[i][3] = data1[i].Timetxt.concat(data1[i].Unit);
      d1array[i][4] = data1[i].Athlete;
      d1array[i][5] = data1[i].Nationality;
      d1array[i][6] = formatTime(data1[i].Year);}
  
  
 
  data2 = data.filter(function(d){return d.Sport == sportselected1 && d.Gender == genderselected1 && d.Event == eventselected1 });
 
//Tranforming data, from an array of objects to 2 D array of   data , for dynamic table creation
 var d2array =[];
  d2array[0] =[];
 	  
  for (i=0;i<data2.length;i++)
   { d2array[i] = []; 
   d2array[i][0] = data2[i].Sport;
      d2array[i][1] = data2[i].Gender;
      d2array[i][2] = data2[i].Event;
      d2array[i][3] = data2[i].Timetxt.concat(data2[i].Unit);
      d2array[i][4] = data2[i].Athlete;
      d2array[i][5] = data2[i].Nationality;
     // d2array[i][6] = data2[i].Location;
      d2array[i][6] = formatTime(data2[i].Year);}
 
   
  
  
  //Making Y domain a function of selected data;
  superdata = data1.concat(data2);
  
  superdata.sort(function(a, b) {
    return a.Time- b.Time;
  });
   y.domain([superdata[0].Time-1,superdata[superdata.length -1].Time]);
   
   
   redrawline1(data1);
   redrawline2(data2);
     
   
   
   //Populating data  for Sum table
    rowa1data = (data1[0].Gender).concat("'s ",data1[0].Sport," ",data1[0].Event);
  rowa2data = data1.length-1;
 rowa3data = data1[data1.length-1].Timeinseconds - data1[0].Timeinseconds;
 rowa3data = rowa3data.toFixed(2);
 rowa3data = rowa3data.concat(' sec');
  
  
     rowb1data = (data2[0].Gender).concat("'s ",data2[0].Sport," ",data2[0].Event);
  rowb2data = data2.length-1;
  rowb3data = data2[data2.length-1].Timeinseconds - data2[0].Timeinseconds;
  rowb3data = rowb3data.toFixed(2);
 rowb3data = rowb3data.concat(' sec');
   
   alldata = [[rowa1data,rowa2data,rowa3data],[rowb1data,rowb2data,rowb3data]];//,[rowc1data,rowc2data,rowc3data]];
  
  //add table 

Sumtable.selectAll("tr").remove();


var columns = ['Event','No. of Records Set', 'Decline in Time', 'Records'];

Sumtable.selectAll("th")
    .data(columns)
    .enter()
    .append("th")
    .text(function(d) {
        return d;
    });
	
var trows = Sumtable.selectAll("tr")
    .data(alldata)
    .enter()
    .append("tr");

var tcells = trows
    .selectAll("td")
    .data(function(d, i) { return d; })
    .enter()
    .append("td")
    .text(function(d, i) { return d; });

//thead.append("th").text('Action');
trows.selectAll("td.button")  
//use a class so you don't re-select the existing <td> elements
          .data(function(d) {return [d];})
          .enter()
            .append("td")
            .attr("class", "button")
            .append("button")			
	        .attr("id",function(d,i,j) {return "button"+j;})
            .text(function(d){return "Details"});
			
 //# creating table -on click button display
d3.select("#test3").selectAll("tr").remove();
//PopTable1
var columns2 = ['Sport','Gender','Event','Time','Athlete','Nationality','Year'];

var thead4 = d3.select("#test3").selectAll("th")
    .data(columns2)
    .enter()
    .append("th")
    .text(function(d) {
        return d;
    });
	
var rows4 =d3.select("#test3").append('tbody').selectAll("tr").data(d1array).enter() .append("tr");
var cells4 = rows4.selectAll("td").data(function(d, i) { return d; })
             .enter()
             .append("td")
              .text(function(d, i) { return d; });
 
//PopTable2
d3.select("#test4").selectAll("tr").remove();
var thead5 = d3.select("#test4").selectAll("th")
    .data(columns2)
    .enter()
    .append("th")
    .text(function(d) {
        return d;
    });
	
var rows5 =d3.select("#test4").append('tbody').selectAll("tr").data(d2array).enter() .append("tr");
var cells5= rows5.selectAll("td").data(function(d, i) { return d; })
             .enter()
             .append("td")
              .text(function(d, i) { return d; });
	
////////////////////////////////
$(document).ready(function() {			
$("#button0").click(function (){
   
   $( "#dialog-modal3" ).dialog({
          open : function (event, ui){$("#test3").appendTo("#dialog-modal3");       
	                                   $( "#dialog-modal3" ).show();
	                                   $("#test3").show();
									   },
		  //close : function (event, ui){$( "#dialog-modal" ).html(" " );},
		  height: 500,
		  width: 900,
		   modal: true
        });
$( "#resizable" ).resizable();
   
    });
	
	});
 

  /// for button1
  
  $(document).ready(function() {			
$("#button1").click(function (){

   $( "#dialog-modal4" ).dialog({
          open : function (event, ui){$("#test4").appendTo("#dialog-modal4");       
	                                  $( "#dialog-modal4" ).show();
	                                  $("#test4").show();
									 },
		 // close : function (event, ui){$( "#dialog-modal" ).html(" " );},
          height: 500,
		  width: 900,
		   modal: true
        });
$( "#resizable" ).resizable();
   //.delay(1000).fadeOut();
    });
	
	});
 
			
   ///////////////////WINDOW RESIZE///////////////////////////////////
   
   $(window).resize(function () {
   $('.ui-dialog').css({
        'width': $(window).width(),
        'height': $(window).height(),
        'left': '0px',
        'top':'0px'
   });
}).resize(); 

  
   
   })
  }
  
  function redrawline1 (data1){
  
  
data1.push({
Sport:"Dummy",	
Gender:"Dummy",
Event:"Dummy",
Time:data1[data1.length -1].Time,
Timetxt: 'Dummy',
Athlete:'Dummy',
Nationality:'Dummy',
Year: parseDate('2017'),
Timeinseconds:data1[data1.length -1].Timeinseconds});
    
 
 // Select the section we want to apply our changes to
    var svg2 = d3.select("body").transition();
   
    // Make the changes
        svg2.select(".line")   // change the line
            .duration(500)
            .attr("d", line(data1));
			
     
	   
	   svg2.selectAll("rect.bar")
	    .duration (500)
 	.attr("y",y(data1[data1.length -1].Time)-10)
  .attr("x", width+25);
  
  
	   svg2.selectAll("rect.startbar")
	    .duration (500)
 	.attr("y",height/10-100)
  .attr("x", 50);
  
  
	   svg2.selectAll("rect.endbar")
	    .duration (500)
 	.attr("y",height/4)
  .attr("x", width+100);
			
    //    svg2.select(".y.axis") // change the y axis
      //      .duration(500)
       //     .call(yAxis); 
data1 = data1.filter(function(d){return formatTime(d.Year) != "2017"});	  
//svg.selectAll('rect').remove();
 svg.selectAll('.perftxt').remove();
 svg.selectAll('.starttxt').remove();
 svg.selectAll('.endtxt').remove();
 
svg2.selectAll("circle").remove();
			
		// Add the scatterplot
    svg.append("g").selectAll("circle")
        .data(data1)
      .enter().append("circle")
        .attr("r", 3)
  .attr("fill","steelblue").attr("clip-path", "url(#clip)")
        .attr("cx", function(d) { return x(d.Year); })
        .attr("cy", function(d) { return y(d.Time); })
		.on("mouseover", function(d) {      
            div.transition()        
                .duration(50)      
                .style("opacity", .9);      
             div.html(d.Athlete+"<br/>"+"Time:" +d.Timetxt+ "("+d.Unit+ ")"+"<br/>" +"Year:"+d.Yeartxt )  
                .style("left", (d3.event.pageX+35) + "px")     
                .style("top", (d3.event.pageY - 28) + "px");    
            })                  
        .on("mouseout", function(d) {       
            div.transition()        
                .duration(100)      
                .style("opacity", 0);   
        });
//svg.append('rect')
  //    .attr("y",y(data1[data1.length -1].Time)-10)
	//	  .attr("x", width+25)
   //.attr("width",55)
  //.attr("height",30)
  //.style("fill","#e6f2ff");
	  //.style("border", 1)
	 // .style("stroke", "black");
	  
svg.append('text')
.attr("class","perftxt")
	  .attr("y",y(data1[data1.length -1].Time)+10)
		  .attr("x", width+27.5)
	  .text(((data1[0].Timeinseconds - data1[data1.length -1].Timeinseconds)/data1[0].Timeinseconds*100 ).toFixed(2)+"%");
  	 
	  
svg.append('text')
        .attr("class","starttxt")
		.attr("font-size","90%")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
        .attr("y",height/10-100)
      .attr("x", 140)
	.append('tspan')
	  .attr('dy', 20)
	  .attr("x", 130)
	  .text(data1[0].Athlete)
	  .append('svg:tspan')
	   .attr("x",130)
  .attr('dy', 20)
  .text("Time:" +data1[0].Timetxt +"("+data1[0].Unit+ ")")
  .append('svg:tspan')
    .attr("x", 130)
  .attr('dy', 20)
  .text("Year:"+data1[0].Yeartxt );

 
   
svg.append('text')
      .attr("class","endtxt")
	  .attr("font-size","90%")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
	  .attr("class","endtxt")
		  .attr("y",height/4)
			  .attr("x",width+180)
	.append('tspan')
	.attr("x",width+180)
  .attr('dy', 20)
	  .text(data1[data1.length-1].Athlete)
	  .append('svg:tspan')
	    .attr("x",width+180)
  .attr('dy', 20)
  .text("Time:" +data1[data1.length-1].Timetxt +"("+data1[data1.length-1].Unit+ ")")
  .append('svg:tspan')
 .attr("x",width+180)
  .attr('dy', 20)
  .text("Year:"+data1[data1.length-1].Yeartxt );
  
   
 		

	
};

function redrawline2 (data2){
  
 data2.push({
Sport:"Dummy",	
Gender:"Dummy",
Event:"Dummy",
Time:data2[data2.length -1].Time,
Timetxt: 'Dummy',
Athlete:'Dummy',
Nationality:'Dummy',
Year: parseDate('2017'),
Timeinseconds:data2[data2.length -1].Timeinseconds});

 var svg2 =d3.select("body").transition();
 
     // Make the changes
      svg2.select(".line2")   // change the line
       .transition().duration(500)
      .attr("d", line2(data2));
	  
	data2 = data2.filter(function(d){return formatTime(d.Year) != "2017"});	  
  
 svg2.selectAll("rect.bar2")
	    .duration (500)
 	.attr("y",y(data2[data2.length -1].Time)-10)
  .attr("x", width+25);
	  
svg.append('text')
.attr("class","perftxt")
	  .attr("y",y(data2[data2.length -1].Time)+10)
		  .attr("x", width+27.5)
	  .text(((data2[0].Timeinseconds - data2[data2.length -1].Timeinseconds)/data2[0].Timeinseconds*100 ).toFixed(2)+"%");
  	 
  svg2.selectAll("rect.startbar1")
	    .duration (500)
 	.attr("y",height/1.5)
  .attr("x", 50);
  
  
	   svg2.selectAll("rect.endbar1")
	    .duration (500)
 	.attr("y",height/2)
  .attr("x", width+100);
 
 		
     // Add the scatterplot
    svg.append("g").selectAll("circle")
        .data(data2)
      .enter().append("circle")
        .attr("r", 3)
  .attr("fill","red").attr("clip-path", "url(#clip)")
        .attr("cx", function(d) { return x(d.Year); })
        .attr("cy", function(d) { return y(d.Time); })
		.on("mouseover", function(d) {      
            div1.transition()        
                .duration(50)      
                .style("opacity", .9);      
             div1.html(d.Athlete+"<br/>"+"Time:" +d.Timetxt+ "("+d.Unit+ ")"+"<br/>" +"Year:"+d.Yeartxt )  
                .style("left", (d3.event.pageX+35) + "px")     
                .style("top", (d3.event.pageY - 28) + "px");    
            })                  
      .on("mouseout", function(d) {       
            div1.transition()        
                .duration(100)      
                .style("opacity", 0);   
        });

svg.append('text')
        .attr("class","starttxt")
		.attr("font-size","90%")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
        .attr("y",height/1.5)
      .attr("x", 140)
	.append('tspan')
	.attr("x", 140)
  .attr('dy', 20)
	  .text(data2[0].Athlete)
	  .append('svg:tspan')
	  .attr("x", 140)
  .attr('dy', 20)
  .text("Time:" +data2[0].Timetxt +"("+data2[0].Unit+ ")")
  .append('svg:tspan')
  .attr("x", 140)
  .attr('dy', 20)
  .text("Year:"+data2[0].Yeartxt );

 
  svg.append('text')
    	  .attr("class","endtxt")
		  .attr("font-size","90%")
      .attr("font","sans-serif")
	  .attr("text-anchor","middle")
	  .attr("y",height/2)
		  .attr("x",width+190)
	.append('tspan')
	.attr("x",width+190)
  .attr('dy', 20)
	  .text(data2[data2.length-1].Athlete)
	  .append('svg:tspan')
	.attr("x",width+190)
  .attr('dy', 20)
  .text("Time:" +data2[data2.length-1].Timetxt +"("+data2[data2.length-1].Unit+ ")")
  .append('svg:tspan')
.attr("x",width+190)
  .attr('dy', 20)
  .text("Year:"+data2[data2.length-1].Yeartxt );
  
   
  
};

</script>

<div id = "keyrecord" style = "display-none"></div>
<div id="dialog-modal" style="display:none"></div>
<div id="dialog-modal1" style="display:none"></div>
<div id="dialog-modal3" style="display:none"></div>
<div id="dialog-modal4" style="display:none"></div>

<table id = "test1" style = "display:none"></table>
<table id = "test2" style = "display:none"></table>
<table id = "test3" style = "display:none"></table>
<table id = "test4" style = "display:none"></table>
<div id="Sumtable"	>
<table style="width:50%">
   
</table>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49609780-1', 'auto');
  ga('send', 'pageview');

</script>